import{b as T,l as n,m as U,p as b,q as X,s as Y,t as O,v as Z,o as a,c as r,j as s,e as t,h as k,I as _,g as y,x as ee,y as te,z as R,A as E,B as $,F as C,r as L,f as oe}from"./index-15ebed20.js";const ne={class:"col center sh"},ae={class:"row center gap-4"},se={key:0},ce={"text-xs":"","text-center":""},le=T({__name:"HAudio",emits:["upload"],setup(I,{emit:f}){const i=n(null),p=n(!1),u=n(!1),l=n(null),B=n(!1),w=n(!1),m=n(!1),d=n(!1),g=n(!1),F=n("0:00"),H=n("0:00"),v=n(null),{state:P}=U(),S=()=>{u.value&&navigator.mediaDevices.getUserMedia({audio:!0}).then(async e=>{i.value=e,p.value=!0;const o=n([]),c=new MediaRecorder(i.value);c.addEventListener("dataavailable",x=>{o.value.push(x.data)}),c.addEventListener("stop",()=>{const x=new Blob(o.value);l.value=new File([x],"audio.webm",{type:"audio/webm"})}),c.start()}).catch(e=>{console.log(e)})},D=()=>{i.value&&(i.value.getTracks().forEach(o=>{o.stop()}),i.value=null,p.value=!1,l.value=null,h.value="")},h=n("");b(()=>{l.value&&(h.value=URL.createObjectURL(l.value))});const j=X({url:Y(()=>h.value)});O(()=>{b(()=>{u.value?S():D()})}),Z(()=>{D()}),O(()=>{J()});const A=e=>{B.value=e},M=e=>{w.value=e},N=e=>{g.value=e,K()},V=e=>{d.value=e},W=(e,o)=>{console.log(e,o)},q=()=>{v.value.play()},z=()=>{v.value.replay()},G=()=>{v.value.pause()},J=()=>{b(()=>{if(v.value===null||!g.value)return;const e=v.value.getCurrentTime();F.value=e})},K=()=>{const e=v.value.getDuration();H.value=e},Q=async()=>{const e=new FormData;e.append("file",l.value);const{data:o}=await $(`api/upload?uid=${P.user.ref}`,{method:"POST",body:e}).json(),{url:c}=t(o);console.log(c),h.value=c,f("upload")};return(e,o)=>(a(),r("main",ne,[s("section",ae,[s("button",{onClick:o[0]||(o[0]=c=>u.value=!t(u))},[t(u)?(a(),k(t(_),{key:1,icon:"mdi-microphone-off","hover:text-primary":"",cp:"",scale:""})):(a(),k(t(_),{key:0,icon:"mdi-microphone","hover:text-primary":"",cp:"",scale:""}))]),s("div",null,[t(m)?(a(),r("button",{key:0,onClick:G},[y(t(_),{icon:"mdi-pause",cp:"",scale:"","hover:text-primary":""})])):(a(),r("button",{key:1,onClick:q},[y(t(_),{icon:"mdi-play",cp:"",scale:"","hover:text-primary":""})]))]),s("button",null,[t(m)?(a(),k(t(_),{key:0,icon:"mdi-refresh",onClick:z,cp:"",scale:""})):(a(),k(t(_),{key:1,icon:"mdi-upload",cp:"",scale:"",onClick:Q}))])]),t(h)?(a(),r("div",se,[y(t(te),ee({ref_key:"waveformRef",ref:v,class:"w-2/3 h-2/3"},t(j),{onOnInit:A,onOnFetched:M,onOnReady:N,onOnPlay:o[1]||(o[1]=c=>m.value=c),onOnPause:o[2]||(o[2]=c=>m.value=c),onOnFinish:V,onOnClick:W}),null,16),s("div",ce,R(t(F))+" - "+R(t(H)),1)])):E("",!0)]))}});const re={row:""},ie={class:"col start h-86vh w-1/4"},ue={col:"",center:"","w-64":""},de={row:"",center:"","m-2":""},ve={"text-caption":"","mx-1":""},pe=["src"],me={grid3:"","w-full":""},_e=s("footer",{"h-24":""},null,-1),he=T({__name:"audio",setup(I){const f=n([]),{state:i}=U(),p=async()=>{const{data:l}=await $(`/api/records?uid=${i.user.ref}`).json();f.value=t(l)},u=async l=>{await $(`/api/records/delete?key=${l.key}`),await p()};return O(async()=>{setTimeout(()=>{p()},1e3)}),(l,B)=>{const w=oe("Icon"),m=le;return a(),r(C,null,[s("div",re,[s("div",ie,[t(f)?(a(!0),r(C,{key:0},L(t(f),d=>(a(),r("div",ue,[s("div",de,[s("h1",ve,R(new Date(d.created_at).toLocaleDateString()),1),y(w,{class:"text-warning hover:text-danger cursor-pointer scale",icon:"mdi-delete",onClick:g=>u(d)},null,8,["onClick"])]),s("audio",{controls:"","w-48":"",invert:"","m-2":"",src:d.url},null,8,pe)]))),256)):E("",!0)]),s("div",me,[(a(),r(C,null,L([1,2,3,4,5,6,7,8,9],d=>y(m,{onUpload:p,id:d},null,8,["id"])),64))])]),_e],64)}}});export{he as default};
